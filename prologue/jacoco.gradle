jacoco {
    toolVersion '0.8.8'
}

jacocoTestReport {
    dependsOn test
    reports {
        html.enabled true
        csv.enabled true
        xml.enabled true
    }

    rootProject.subprojects.forEach {
        println it.name
        def subProject = it
        sourceDirectories.from(files(subProject.sourceSets.main.allSource.srcDirs))
        classDirectories.from(files(subProject.sourceSets.main.output))
    }
    finalizedBy 'jacocoTestCoverageVerification'
}

jacocoTestCoverageVerification {
    violationRules {
        rule {
            enabled = true
            element = 'CLASS'

            limit {
                counter = 'LINE'
                value = 'COVEREDRATIO'
                minimum = 0.00
            }

            limit {
                counter = 'BRANCH'
                value = 'COVEREDRATIO'
                minimum = 0.00
            }
            excludes = []
        }
    }
}
